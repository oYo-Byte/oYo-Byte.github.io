<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>解读C语言声明 | oYo</title>

  
  <meta name="author" content="oYo-Byte">
  

  
  <meta name="description" content="C语言所有复杂的指针声明，都是由各种声明嵌套构成的。如何解读复杂指针声明呢？ 
右左法则（既著名又常用的方法 ）
右左法则英文原文：

The right-left rule: Start reading the declaration from the innermost parentheses,">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="解读C语言声明"/>

  <meta property="og:site_name" content="oYo"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="oYo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">oYo</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>解读C语言声明</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/26/解读C语言声明/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-26T03:18:23.922Z">
          2018-07-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>C语言所有复杂的指针声明，都是由各种声明嵌套构成的。如何解读复杂指针声明呢？ </p>
<p>右左法则（既著名又常用的方法 ）</p>
<p>右左法则英文原文：</p>
<blockquote>
<p>The right-left rule: Start reading the declaration from the innermost parentheses, go right, and then go left. When you encounter parentheses, the direction should be reversed. Once everything in the parentheses has been parsed, jump out of it. Continue till the whole declaration has been parsed. </p>
</blockquote>
<p>翻译如下：</p>
<p>右左法则：首先从最里面的圆括号看起，然后往右看，再往左看。每当遇到圆括号时，就应该掉转阅读方向。一旦解析完圆括号里面所有的东西，就跳出圆括号。重复这个过程直到整个声明解析完毕。 </p>
<p>这时就会有个疑惑：怎样判断那个括号是最里面的呢？</p>
<p>因此需要对这个法则进行修改，结合《C专家编程》里提到的分析方法，应该是从未定义的标识符开始阅读，而不是从括号读起，之所以是未定义的标识符，是因为一个声明里面可能有多个标识符，但未定义的标识符只会有一个。 </p>
<p>分析C语言的声明步骤：</p>
<ul>
<li>第1步：从左至右，找到第一个未定义的标识符。</li>
<li>第2步：查看标识符右边的符号，并确定是一个数组还是函数。</li>
<li>第3步：查看左边的符号。</li>
<li>第3步a：如果是左括号则将处理过的部分结合到一起直到遇到右括号作为标识符返回第2步。</li>
<li>第3步b：如果是const，volatile，*其中之一则继续向左直到不是这三个符号之一。</li>
<li>第4步：剩下的符号构成声明的基本类型。</li>
</ul>
<p>感觉还是有点晕？</p>
<p>结合例子说明：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> (*(*x[<span class="number">3</span>])())[<span class="number">5</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li>第1步：从左到右找到第一个标识符x。</li>
<li>第2步：查看标识符右边的符号是<code>[</code>，说明x是一个具有3个元素的数组。</li>
<li>第3步：查看左边的符号是<code>*</code>，转至第3步b。</li>
<li>第3步b：说明数组中的元素都是指针，向左就是左括号了，将这个左括号结合到对应的右括号（也就是<code>(*x[3])</code>）作为新的标识符返回第2步 。</li>
<li>第2步：查看右边的符号是<code>(</code>，说明指针是指向参数列表为空的函数的指针。 </li>
<li>查看左边的符号，是<code>*</code>, 转至第3步b。 </li>
<li>说明函数的返回值是指针，向左是左括号，将这个左括号结合到对应的右括号（也就是<code>(*(*x[3])())</code>）作为新的标识符返回第2步。 </li>
<li>第2步：查看右边的符号是<code>[</code>，所以是指向具有五个元素的数组的指针。 </li>
<li>第3步：查看左边的括号，既不是a情况，也不是b情况，跳至第4步。 </li>
<li>第4步：数组的类型为char。 </li>
</ul>
<p>所以以上的声明表示的是x是一个具有3个元素的数组，数组的每个元素都是一个指向函数的指针，函数的参数列表为空，返回值是指向一个具有5个元素的指针，元素的类型为char。 </p>
<p>Try:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">char</span> *(*c[<span class="number">10</span>])(<span class="keyword">int</span> **p)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><br></p>
<p>Clockwise/Spiral Rule（顺时针/螺旋法则）</p>
<p>三步：</p>
<ol>
<li><p>从未定义标识符开始，以顺时针方向移动，当遇到以下元素时，用相应的语言陈述替换它们：</p>
<p>​    <code>[X]</code> or <code>[]</code> =&gt;  Array X size of… or Array undefined size of… </p>
<p>​    <code>(type1, type2)</code> =&gt; function passing type1 and type2 returning… </p>
<p>​    <code>*</code> =&gt;  pointer(s) to… </p>
</li>
<li><p>继续以上步骤，直至覆盖所有的字符。</p>
</li>
<li><p>首先解决括号中的内容。</p>
</li>
</ol>
<p>例1：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *str[<span class="number">10</span>];</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">     +-------+</span><br><span class="line">     | +-+   |</span><br><span class="line">     | ^ |   |</span><br><span class="line"><span class="keyword">char</span> *str[<span class="number">10</span>];</span><br><span class="line"> ^   ^   |   |</span><br><span class="line"> |   +---+   |</span><br><span class="line"> +-----------+</span><br></pre></td></tr></table></figure>
<ul>
<li><p>str是什么？</p>
<p>“str是一个……</p>
</li>
<li><p>从str开始以顺时针方向移动，遇到<code>[</code>，这意味着是一个数组</p>
<p>‘’str是一个长度为10的数组，元素是……</p>
</li>
<li><p>继续移动，遇到<code>*</code>,说明是指针</p>
<p>‘’str是一个长度为10的数组，元素是指向……的指针</p>
</li>
<li><p>继续遇到了<code>;</code>，然后继续移动，遇到<code>char</code></p>
<p>“str是一个长度为10的数组，元素是指向char的指针”</p>
</li>
<li><p>遍历完所有字符，解析完毕</p>
</li>
</ul>
<p>Try:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span>  <span class="keyword">char</span> *(*fp)( <span class="keyword">int</span>, <span class="keyword">float</span> *);</span><br><span class="line"><span class="number">3.</span>  <span class="keyword">void</span> (*signal(<span class="keyword">int</span>, <span class="keyword">void</span> (*fp)(<span class="keyword">int</span>)))(<span class="keyword">int</span>);</span><br></pre></td></tr></table></figure>
<p> <br>  <br>  <br>  <br>  <br>  <br>  <br>  <br></p>
<p>Answer：</p>
<ol>
<li>c是一个具有10个元素的数组，数组的元素都是函数指针，其所指向的函数是接受一个指向整型指针的指针，返回值是指向char的指针。</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     +-----------------+</span><br><span class="line">     | +------+     +-+|</span><br><span class="line">     | |++    |     |++|</span><br><span class="line">     | |^|    |     |^||</span><br><span class="line"><span class="keyword">char</span> *(*c[<span class="number">10</span>])(<span class="keyword">int</span> **p);</span><br><span class="line">  ^  ^ ^ |    |    ^^ || </span><br><span class="line">  |  | +-+    |    |+-+|</span><br><span class="line">  |  +--------+    +--+|</span><br><span class="line">  +--------------------+</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     +--------------------+</span><br><span class="line">     | +---+              |</span><br><span class="line">     | |+-+|              |</span><br><span class="line">     | |^ ||              |</span><br><span class="line">char *(*fp)( int, float *);</span><br><span class="line"> ^   ^ ^  ||              |</span><br><span class="line"> |   | +--+|              |</span><br><span class="line"> |   +-----+              |</span><br><span class="line"> +------------------------+</span><br></pre></td></tr></table></figure>
<p>fp是一个函数指针，该函数接受一个整型和一个浮点型指针入参，返回值是指向char的指针。</p>
</li>
<li></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">      +-----------------------------+</span><br><span class="line">      |                  +---+      |</span><br><span class="line">      |  +---+           |+-+|      |</span><br><span class="line">      |  ^   |           |^ ||      |</span><br><span class="line">void (*signal(int, void (*fp)(int)))(int);</span><br><span class="line"> ^    ^      |      ^    ^  ||      |</span><br><span class="line"> |    +------+      |    +--+|      |</span><br><span class="line"> |                  +--------+      |</span><br><span class="line"> +----------------------------------+</span><br></pre></td></tr></table></figure>
<p>signal是一个函数，该函数值一个接受一个整型和一个函数指针（该函数是入参是整型，返回值为空void），返回值是指向一个入参是整型，返回值是空void的函数指针。</p>
<p>参考：</p>
<p><a href="https://blog.csdn.net/wangweixaut061/article/details/6549768" target="_blank" rel="noopener">C语言复杂声明解析</a>  </p>
<p><a href="https://blog.csdn.net/jixuxjixu3/article/details/5824431" target="_blank" rel="noopener">c语言声明的分析方法 </a>  </p>
<p><a href="http://c-faq.com/decl/spiral.anderson.html" target="_blank" rel="noopener">The Clockwise/Spiral Rule</a>  </p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 oYo-Byte
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>